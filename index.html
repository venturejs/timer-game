<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10초 맞추기 게임</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        #debugArea {
            margin-top: 20px;
            background-color: #f0f0f0;
            padding: 10px;
            border: 1px solid #ccc;
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>Telegram WebApp 데이터 전송 테스트</h1>
    <button id="sendDataBtn">데이터 보내기</button>
    <div id="debugArea">
        <h3>디버그 로그:</h3>
        <pre id="debugLog"></pre>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const sendDataBtn = document.getElementById('sendDataBtn');
        const debugLog = document.getElementById('debugLog');

        // 로깅 함수
        function logDebug(message) {
            debugLog.textContent += message + '\n';
            console.log(message);
        }

        // Telegram WebApp 초기화
        tg.ready();
        tg.expand();

        // 초기 WebApp 상태 로깅
        logDebug('WebApp 초기 상태:');
        logDebug(`tg.initData: ${tg.initData}`);
        logDebug(`tg.initDataUnsafe: ${JSON.stringify(tg.initDataUnsafe)}`);

        // 데이터 보내기 버튼 이벤트
        sendDataBtn.addEventListener('click', () => {
            logDebug('\n데이터 전송 시도:');
            
            try {
                // 다양한 데이터 전송 방법 테스트
                logDebug('1. tg.sendData() 사용');
                tg.sendData(JSON.stringify({
                    type: 'test',
                    timestamp: Date.now(),
                    message: '테스트 메시지'
                }));

                logDebug('2. MainButton을 통한 데이터 전송');
                tg.MainButton.setText('데이터 전송');
                tg.MainButton.show();
                tg.MainButton.onClick(() => {
                    tg.sendData(JSON.stringify({
                        type: 'mainButtonTest',
                        timestamp: Date.now()
                    }));
                });

                logDebug('3. WebView 메시지 API 사용');
                window.parent.postMessage(JSON.stringify({
                    type: 'webViewTest',
                    timestamp: Date.now()
                }), '*');
            } catch (error) {
                logDebug(`오류 발생: ${error.message}`);
            }
        });

        // 메시지 수신 이벤트 리스너
        window.addEventListener('message', (event) => {
            logDebug('\n메시지 수신:');
            logDebug(`수신된 데이터: ${event.data}`);
        });

        // Telegram WebApp 이벤트 리스너
        tg.onEvent('mainButtonClicked', () => {
            logDebug('메인 버튼 클릭됨');
        });

        tg.onEvent('webAppClose', () => {
            logDebug('웹앱 닫힘');
        });
    </script>
</body>
</html>